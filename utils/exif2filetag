#!/usr/bin/env bash

# TODO: Document properly. Comments.

path=${1:-}
tag=${2:-}

function die()
{
    printf "%s. Exiting ..\n" "${1:-"Unspecified error"}" 2>&1
    exit 1
}

[ -n "$path" ] || die "Path not specified"
[ -d "$path" ] || die "Invalid path"
[ -n "$tag" ] || die "Exif tag not specified"

printf "%10.10s : %-50.50s\n" "path" "$path"
printf "%10.10s : %-50.50s\n" "tag" "$tag"


function find_images_with_exif_tag()
{
    exiftool -quiet -ignoreMinorErrors -if "\$keywords =~ /${tag}/i" -filename -r -p '$directory/$filename' "$path"
}

find_images_with_exif_tag | xargs filetags --dryrun -t "$tag" 

# works
#filetags --dryrun -t "$tag" $(find_images_with_exif_tag)

#exiftool -ignoreMinorErrors -if "\$keywords =~ /${tag}/i" -filename -r -p '$directory/$filename' "$path"

exit $?
